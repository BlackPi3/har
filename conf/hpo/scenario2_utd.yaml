# Per-scenario, per-dataset search space for Hydra Optuna Sweeper
# Activate with: -m hydra/sweeper=optuna hpo=scenario2_utd

study_name: scenario2_utd
trial: scenario2_utd

hydra:
  sweeper:
    study_name: ${study_name}
    storage: "sqlite:///experiments/hpo/${study_name}/${study_name}.db"
    params:
      # Narrow optimizer ranges (UTD quickly overfits)
      optim.lr: tag(log, interval(4e-4, 1.2e-3))
      optim.weight_decay: tag(log, interval(5e-5, 3e-4))
      optim.warmup_epochs: choice(4, 5)
      optim.warmup_start_factor: choice(0.05, 0.1)

      # Loss balances stay near prior best settings
      trial.alpha: choice(0.5, 1, 2)
      trial.beta: choice(5, 10, 15)
      trial.gamma: choice(0.5, 1, 2)

      # UTD sequences are short, so keep windows tight
      data.sensor_window_length: choice(90, 100, 110)
      data.stride_seconds: choice(0.2, 0.25)
      model.feature_extractor.n_filters: choice(12, 16, 20)
      model.feature_extractor.filter_size: choice(5, 7)
      model.regressor.joint_hidden_channels: choice([48, 48, 32, 16], [64, 64, 32, 32])
      model.regressor.joint_kernel_sizes: choice([3, 3, 3, 1], [5, 5, 3, 1])
      model.regressor.joint_dilations: choice([1, 2, 4, 1], [1, 3, 5, 1])
      model.regressor.temporal_hidden_channels: choice(16, 24)
      model.regressor.temporal_kernel_size: choice(3, 5)
      model.regressor.temporal_dropout: choice(0.2, 0.3, 0.4)
      model.regressor.fc_hidden: choice(0, 64)
      model.regressor.fc_dropout: choice(0.1, 0.15, 0.2)
      model.regressor.use_batch_norm: choice(true, false)

  sweep:
    dir: "experiments/hpo/${study_name}/trials"
    subdir: trial_${hydra.job.num}

trainer:
  name: scenario2
  objective:
    metric: val_f1
    mode: max

data:
  name: utd
