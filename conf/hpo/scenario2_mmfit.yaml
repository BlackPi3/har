# Per-scenario, per-dataset search space for Hydra Optuna Sweeper
# Activate with: -m hydra/sweeper=optuna hpo=scenario2_mmfit

# This file declares the search space (params) and the objective.

# Also define the objective to optimize for this space.
hpo:
  metric: val_f1
  mode: maximize

hydra:
  sweeper:
    # Keep sweep-level defaults close to the space so CLI can stay minimal
    direction: ${hpo.mode}
    # Single source of truth for study name: derive from selected hpo group
    study_name: ${hydra:runtime.choices.hpo}
    # Store Optuna DB alongside trials in scratch, per-study folder
    storage: "sqlite:////netscratch/${oc.env:USER}/experiments/output/${hydra:runtime.choices.hpo}/${hydra:runtime.choices.hpo}.db"
    params:
      # Optimizer
      optim.lr: tag(log, interval(1e-5, 1e-2))
      optim.weight_decay: tag(log, interval(1e-6, 1e-2))

      # Scenario2-specific loss coefficients
      scenario.alpha: interval(0, 10)
      scenario.beta: interval(0, 10)

      # Data/model coupling (MM-Fit typical ranges)
      data.sensor_window_length: choice(128, 192, 256, 320, 384, 448, 512)
      data.stride_seconds: choice(0.1, 0.2, 0.5, 1.0)
      model.feature_extractor.n_filters: range(8, 32, 4)
      model.feature_extractor.filter_size: range(3, 9, 2)

      # Throughput knobs
      data.batch_size: choice(1024, 1536, 2048)

  sweep:
    # Place all trials under a unified per-study directory
    dir: /netscratch/${oc.env:USER}/experiments/output/${hydra:runtime.choices.hpo}
    subdir: trial_${hydra.job.num}
